# 日間メニュー作成時のInternal Server Error 対処法

## エラーの確認方法

### 1. バックエンドサーバーのコンソールを確認

バックエンドサーバーが起動しているターミナルで、以下のようなログが表示されます：

```
Create menu request: { storeId: 'sample-store-001', name: '...', ... }
```

エラーが発生している場合、以下のようなログが表示されます：

```
Create menu error: [エラーメッセージ]
Error stack: [スタックトレース]
```

### 2. ブラウザの開発者ツールで確認

1. **F12キー**を押して開発者ツールを開く
2. **Networkタブ**を開く
3. メニューを投稿してみる
4. `/api/menus/daily` のリクエストをクリック
5. **Responseタブ**でエラーメッセージを確認

### 3. コンソールタブで確認

開発者ツールの**Consoleタブ**で、JavaScriptエラーを確認します。

## よくある原因と対処法

### 1. 認証トークンが正しく送信されていない

**症状**: `認証トークンが必要です` または `認証に失敗しました`

**対処法**:
1. 管理者ログインページで再度ログイン
2. ブラウザの開発者ツール → Applicationタブ → Local Storage
3. `admin_token` が存在するか確認
4. 存在しない場合は、再度ログイン

### 2. データベース接続エラー

**症状**: `メニューの投稿に失敗しました` と表示される

**対処法**:
1. PostgreSQLが起動しているか確認
   ```bash
   # Windowsの場合
   Get-Service -Name postgresql*
   ```

2. データベース接続情報を確認
   - `backend/.env` ファイルを確認
   - `DATABASE_URL` が正しく設定されているか確認

3. データベースに接続できるか確認
   ```bash
   cd backend
   npm run db:migrate
   ```

### 3. 画像サイズが大きすぎる

**症状**: `画像サイズが大きすぎます（10MB以下）`

**対処法**:
- 画像を圧縮するか、より小さい画像を使用する
- 推奨サイズ: 2MB以下

### 4. データベースのカラムが存在しない

**症状**: `column "xxx" does not exist`

**対処法**:
マイグレーションを実行：
```bash
cd backend
npm run db:migrate
```

### 5. バックエンドサーバーが起動していない

**症状**: `Network Error` または `Failed to fetch`

**対処法**:
1. バックエンドサーバーを起動
   ```bash
   cd backend
   npm run dev
   ```

2. `http://localhost:3001` にアクセスして、サーバーが起動しているか確認

## デバッグ手順

### ステップ1: バックエンドサーバーのログを確認

バックエンドサーバーのターミナルで、以下のようなログが表示されるか確認：

```
Create menu request: {
  storeId: 'sample-store-001',
  name: '本日のランチセット',
  category: 'ランチ',
  price: 1200,
  image_url_length: 123456,
  date: '2024-01-01T00:00:00.000Z'
}
```

### ステップ2: エラーメッセージを確認

エラーが発生している場合、以下のようなログが表示されます：

```
Create menu error: [エラーメッセージ]
Error stack: [スタックトレース]
```

### ステップ3: ネットワークリクエストを確認

1. ブラウザの開発者ツール（F12）を開く
2. Networkタブを開く
3. メニューを投稿
4. `/api/menus/daily` のリクエストをクリック
5. **Headersタブ**で以下を確認：
   - `Authorization: Bearer [トークン]` が含まれているか
   - `Content-Type: application/json` が設定されているか
6. **Payloadタブ**でリクエストボディを確認：
   - `name`, `price`, `image_url` が正しく送信されているか

### ステップ4: レスポンスを確認

**Responseタブ**でエラーメッセージを確認：

```json
{
  "error": "エラーメッセージ",
  "details": "詳細なエラー情報（開発環境のみ）"
}
```

## トラブルシューティングチェックリスト

- [ ] バックエンドサーバーが起動している（`http://localhost:3001`）
- [ ] フロントエンドサーバーが起動している（`http://localhost:3000`）
- [ ] PostgreSQLが起動している
- [ ] 管理者としてログインしている
- [ ] `admin_token` がLocalStorageに保存されている
- [ ] データベースのマイグレーションが実行されている
- [ ] 画像サイズが10MB以下である
- [ ] ネットワークリクエストに認証トークンが含まれている

## エラーログの共有方法

問題が解決しない場合、以下の情報を共有してください：

1. **バックエンドサーバーのログ**
   - エラーメッセージ全体
   - スタックトレース

2. **ブラウザの開発者ツールの情報**
   - Networkタブのリクエスト詳細
   - Consoleタブのエラーメッセージ

3. **実行環境**
   - OS（Windows/Mac/Linux）
   - Node.jsのバージョン
   - PostgreSQLのバージョン











