# 🚀 はじめに読むファイル

## 📋 このファイルの目的

システム管理者のログインができない問題を、**1から順番に**確認して解決するためのガイドです。

## 🎯 解決の流れ

1. **データベースの状態を確認**（5分）
2. **問題があれば修正**（5分）
3. **ログインを試す**（1分）

## 📝 ステップ1: データベースの状態を確認

### 1-1. SupabaseのSQL Editorを開く

1. Supabaseダッシュボードにログイン
2. プロジェクトを選択
3. 「SQL Editor」を開く（左側のメニュー）

### 1-2. クイックチェックを実行

`supabase/QUICK_CHECK.sql` の内容をコピー＆ペーストして実行してください。

### 1-3. 結果を確認

以下の4つのチェック結果が表示されます：

1. **チェック1: テーブルの存在確認**
   - ✅ の場合: 次のステップへ
   - ❌ の場合: `COMPLETE_RESET.sql` を実行

2. **チェック2: システム管理者の存在確認**
   - ✅ の場合: 次のステップへ
   - ❌ の場合: システム管理者を作成（下記参照）

3. **チェック3: パスワードハッシュの確認**
   - ✅ の場合: 次のステップへ
   - ❌ の場合: パスワードをリセット（下記参照）

4. **チェック4: システム管理者の詳細情報**
   - すべての情報が表示されることを確認

## 🔧 ステップ2: 問題があれば修正

### 問題1: テーブルが存在しない

**解決方法**:
```sql
-- COMPLETE_RESET.sql の内容を実行
```

### 問題2: システム管理者が存在しない

**解決方法**:
```sql
INSERT INTO system_admins (username, password_hash, name, email)
VALUES (
  'admin',
  '$2a$10$TfL2YgEWStCa.70GOP75Se2cAq24kzyP6vMBgycEnxgDs/D8cx8l.',
  'システム管理者',
  'admin@pic-cul.com'
);
```

### 問題3: パスワードハッシュが正しくない

**解決方法**:
```sql
UPDATE system_admins 
SET password_hash = '$2a$10$TfL2YgEWStCa.70GOP75Se2cAq24kzyP6vMBgycEnxgDs/D8cx8l.'
WHERE username = 'admin';
```

## ✅ ステップ3: ログインを試す

### 3-1. ブラウザのキャッシュをクリア

1. ブラウザの開発者ツールを開く（F12）
2. 「Application」タブを開く
3. 「Storage」→「Clear site data」をクリック
4. すべてのチェックボックスにチェックを入れる
5. 「Clear site data」をクリック

### 3-2. ログインを試す

1. `/system-admin/login` にアクセス
2. ユーザー名: `admin`（**正確に**）
3. パスワード: `admin123`（**スペースなし**）
4. 「ログイン」をクリック

### 3-3. まだエラーが出る場合

ブラウザの開発者ツール（F12）の「Console」タブで、エラーメッセージを確認してください。

## 📊 確認結果の報告

問題が解決しない場合、以下の情報を共有してください：

1. **QUICK_CHECK.sql の実行結果**
   - 各チェックの結果（✅ または ❌）

2. **ブラウザのコンソールのエラーメッセージ**
   - `=== Login Error ===` の後に表示される内容

3. **ネットワークタブのレスポンス**
   - `/api/auth/system-admin/login` のレスポンスボディ

## 🆘 よくある質問

### Q: QUICK_CHECK.sql を実行してもエラーが出る

**A**: テーブルが存在しない可能性があります。`COMPLETE_RESET.sql` を実行してください。

### Q: パスワードハッシュの長さが60でない

**A**: パスワードをリセットしてください（上記の「問題3」を参照）。

### Q: 環境変数はどこで確認するの？

**A**: Vercelダッシュボードの「Settings」→「Environment Variables」で確認できます。

## 📚 関連ファイル

- `STEP_BY_STEP_DEBUG.md` - 詳細なデバッグ手順
- `QUICK_CHECK.sql` - クイックチェック用SQL
- `COMPLETE_RESET.sql` - 完全なリセット用SQL

