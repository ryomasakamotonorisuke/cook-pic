# 401ã‚¨ãƒ©ãƒ¼ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€ã®æœ€çµ‚è§£æ±ºæ–¹æ³•

## ğŸ” ç¾åœ¨ã®çŠ¶æ³

ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ä½œæˆã•ã‚ŒãŸãŒã€ã¾ã ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å ´åˆã®è§£æ±ºæ–¹æ³•ã§ã™ã€‚

## ğŸ› ï¸ è§£æ±ºæ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆ

Supabaseã®SQL Editorã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```sql
-- supabase/FINAL_PASSWORD_RESET.sql ã®å†…å®¹ã‚’å®Ÿè¡Œ
```

ã¾ãŸã¯ã€ç›´æ¥å®Ÿè¡Œï¼š

```sql
-- æ—¢å­˜ã®adminãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å®Œå…¨ã«å‰Šé™¤
DELETE FROM system_admins WHERE username = 'admin';

-- æ–°ã—ã„adminãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: admin123ï¼‰
INSERT INTO system_admins (username, password_hash, name, email)
VALUES (
  'admin',
  '$2a$10$TfL2YgEWStCa.70GOP75Se2cAq24kzyP6vMBgycEnxgDs/D8cx8l.',
  'ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…',
  'admin@pic-cul.com'
);

-- ç¢ºèªï¼ˆé‡è¦ï¼‰
SELECT 
  username, 
  LEFT(password_hash, 30) || '...' AS hash_preview,
  LENGTH(password_hash) AS hash_length
FROM system_admins 
WHERE username = 'admin';
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

å®Ÿè¡Œå¾Œã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. **hash_length ãŒ 60 ã§ã‚ã‚‹ã“ã¨**
2. **hash_preview ãŒ `$2a$10$TfL2YgEWStCa.70GOP75Se...` ã§å§‹ã¾ã‚‹ã“ã¨**

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ï¼‰
2. ã€ŒApplicationã€ã‚¿ãƒ–ã‚’é–‹ã
3. ã€ŒStorageã€â†’ã€ŒClear site dataã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆCtrl+F5 ã¾ãŸã¯ Cmd+Shift+Rï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ­ã‚°ã‚¤ãƒ³ã‚’å†è©¦è¡Œ

- URL: `/system-admin/login`
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å: `admin`ï¼ˆ**æ­£ç¢ºã«**ã€å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã«æ³¨æ„ï¼‰
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: `admin123`ï¼ˆ**ã‚¹ãƒšãƒ¼ã‚¹ãªã—**ï¼‰

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª

```sql
-- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
SELECT 
  username, 
  name,
  LENGTH(password_hash) AS hash_length,
  LEFT(password_hash, 30) AS hash_start,
  created_at,
  updated_at
FROM system_admins 
WHERE username = 'admin';
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
- `hash_length`: 60
- `hash_start`: `$2a$10$TfL2YgEWStCa.70GOP75Se`

### ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ï¼‰
2. ã€ŒConsoleã€ã‚¿ãƒ–ã‚’é–‹ã
3. ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã¿ã‚‹
4. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ç¢ºèª

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ï¼‰
2. ã€ŒNetworkã€ã‚¿ãƒ–ã‚’é–‹ã
3. ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã¿ã‚‹
4. `/api/auth/system-admin/login` ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ã€ŒResponseã€ã‚¿ãƒ–ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª

## âœ… ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `FINAL_PASSWORD_RESET.sql` ã‚’å®Ÿè¡Œã—ãŸ
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã®é•·ã•ãŒ60æ–‡å­—ã§ã‚ã‚‹
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ãŒ `$2a$10$...` ã§å§‹ã¾ã‚‹
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ãŸ
- [ ] ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ãŸ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒ `admin` ã§ã‚ã‚‹ï¼ˆæ­£ç¢ºã«ï¼‰
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒ `admin123` ã§ã‚ã‚‹ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ãªã—ï¼‰

## ğŸ†˜ ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆ

### 1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚’å†ç”Ÿæˆ

Node.jsã§æ–°ã—ã„ãƒãƒƒã‚·ãƒ¥ã‚’ç”Ÿæˆï¼š

```javascript
const bcrypt = require('bcryptjs');
bcrypt.hash('admin123', 10).then(hash => {
  console.log('æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥:', hash);
  console.log('');
  console.log('Supabase SQL Editorã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ:');
  console.log(`UPDATE system_admins SET password_hash = '${hash}' WHERE username = 'admin';`);
});
```

ç”Ÿæˆã—ãŸãƒãƒƒã‚·ãƒ¥ã§æ›´æ–°ï¼š

```sql
UPDATE system_admins 
SET password_hash = 'ç”Ÿæˆã—ãŸãƒãƒƒã‚·ãƒ¥'
WHERE username = 'admin';
```

### 2. ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã‚’å®Œå…¨ã«å†ä½œæˆ

```sql
-- å®Œå…¨ã«å‰Šé™¤
DELETE FROM system_admins WHERE username = 'admin';

-- å†ä½œæˆï¼ˆæ–°ã—ã„ãƒãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ï¼‰
INSERT INTO system_admins (username, password_hash, name, email)
VALUES (
  'admin',
  'ç”Ÿæˆã—ãŸæ–°ã—ã„ãƒãƒƒã‚·ãƒ¥',
  'ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…',
  'admin@pic-cul.com'
);
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã€ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

